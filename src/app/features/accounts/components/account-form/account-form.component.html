<div class="form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ isEditMode() ? 'Edit Account' : 'New Account' }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Account Name</mat-label>
            <input matInput formControlName="name" placeholder="e.g. Main Checking" />
            @if (form.controls.name.hasError('required')) {
              <mat-error>Name is required</mat-error>
            }
            @if (form.controls.name.hasError('minlength')) {
              <mat-error>Name must be at least 3 characters</mat-error>
            }
          </mat-form-field>
        </div>

        <div class="form-row two-col">
          <mat-form-field appearance="outline">
            <mat-label>Type</mat-label>
            <mat-select formControlName="type">
              @for (type of accountTypes; track type) {
                <mat-option [value]="type">{{ type | titlecase }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Currency</mat-label>
            <mat-select formControlName="currency">
              @for (currency of currencies; track currency) {
                <mat-option [value]="currency">{{ currency }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Initial Balance</mat-label>
            <input
              matInput
              type="number"
              formControlName="initial_balance"
              aria-label="Initial Balance"
            />
            <span matTextPrefix>{{ form.controls.currency.value }}&nbsp;</span>
          </mat-form-field>
        </div>

        <div class="form-row two-col">
          <div class="color-selection-container" role="radiogroup" aria-labelledby="color-label">
            <span id="color-label" class="color-label">Color</span>
            <div class="color-grid">
              @for (color of colorPalette; track color) {
                <button
                  type="button"
                  class="color-circle"
                  [style.background-color]="color"
                  [class.selected]="form.controls.color.value === color"
                  (click)="selectColor(color)"
                  [attr.aria-label]="'Select color ' + color"
                  [attr.aria-pressed]="form.controls.color.value === color"
                >
                  @if (form.controls.color.value === color) {
                    <mat-icon class="check-icon">check</mat-icon>
                  }
                </button>
              }
            </div>
            @if (form.controls.color.invalid && form.controls.color.touched) {
              <mat-error class="color-error">Color is required</mat-error>
            }
          </div>

          <mat-form-field appearance="outline">
            <mat-label>Icon</mat-label>
            <input matInput formControlName="icon" placeholder="e.g. ðŸ’°" />
          </mat-form-field>
        </div>

        <div class="actions">
          <button mat-button type="button" routerLink="/accounts" [disabled]="loading()">
            Cancel
          </button>
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="form.invalid || loading()"
          >
            {{ loading() ? 'Saving...' : 'Save' }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
